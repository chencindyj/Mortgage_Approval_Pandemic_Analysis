---
title: 'QMSS GR5015 - Lab #1'
author: "Cindy Chen (cjc2279)"
date: "October 2, 2021"
output:
  html_document: default
  pdf_document: default
---

__*Brief context about my chosen data set: I used the news outlet The Intercept's "Trial and Terror" dataset that features the 950 defendants who have been prosecuted for terrorism since the 9/11 attacks, even though the legitimacy of their charges have been controversial.  There are some issues with data quality in terms of missing data, but the missing data do not preclude me from using it for this Lab assignment.  You can find the data here: https://github.com/firstlookmedia/trial-and-terror-data/ *__

```{r setup, include=FALSE}
df = read.csv("C:/Users/Cindy C/Documents/GitHub/trial-and-terror-data/trial-and-terror.csv")

#load my packages
library(plyr)
library(dplyr)
library(gmodels)
library(stringr)
library(psych)
```

```{r variable names}
names(df) ## what variables are in the dataset?
```

```{r view data, eval = FALSE}
view(df) ##what does the data look like?
```
### 1. Use the table command, summary or describe commands, to tabulate one variable; and explain your results.

I chose to investigate the variable "disposition", which is the current status of each defendant's terrorism case.  This is a categorical variable, so I use "table" and "prop.table" to tabulate my findings.

* We can see in the first table that the majority of defendants (615 of them) have pleaded guilty; as further context, the second table shows that these 615 defendants who pled guilty make up more than half (64.7%) of the population.  Since terrorism is such a serious charge, we would expect that these charges are not casually dismissed and thus, the high proportion of guilty pleas are high.  We also note that two (2) individuals' disposition statuses are blank in the data set; this means that we do not have information on the status of their cases.

* Among the 7 people who have been acquitted or had their charges dropped or dismissed, they make up only 0.7% of the population.  This means it is extremely rare that defendants of terrorism successfully fight their terrorism charges and are consequently released.

```{r table 1}
  knitr::kable(           #used knitr::kable to format the table
    table(df$disposition)) #counts (or in other words, tabulates) the number of defendants by their disposition status 
```

``` {r table 2 - proportions}
  knitr::kable(                       #used knitr::kable to format the table
  prop.table(table(df$disposition))) #provides the proportion of defendants with that specific disposition status
```

### 2. Using either the plyr commands (the doBy command does not work anymore), compare the means and standard deviations for one variable, for at least two sub-groups; and explain your results.

I chose to investigate the variable "Case_Imprisonment", which denotes the prison sentence that the defendant received. Since my data set is text-based (there is no numeric data), I have created a new variable called "Case_Imprisonment_Num" that converts the text-based time period described in the "Case_Imprisonment" variable into a number (in months).  For instance, if an entry says "2 years and 10 months", then the defendant received 34 months in prison and I have created a column with the month conversion.

Afterwards, I have used the ddply function to create a summary table to view the mean and standard deviation of terrorists' prison sentences (in months) by the sub-groups "case_charge_1" (which is their primary terrorism-related criminal charge) and "gender". I chose these two variables because I was curious about the variation in prison sentence lengths based on gender and the seriousness of the crime.  Where there are blanks, we know that we are missing information but the magnitude of these missing values is negligible.

* Through the data, we can see that the largest standard deviation in prison sentences occurs for male terrorists prosecuted for tax violations (534.6 months or ~45 years with an average sentence of 402 months or ~34 years). This is notable since tax violation seems like much lesser crime than charges like assault and murder, yet it carries a sentence length that can greatly vary and on average, seems like a strict punishment. If we dig into the data, we can see that this wide standard deviation is driven by our sparse yet extreme data points: one person received a sentence of 65 years while someone else received only 2 years for tax violations.

* The highest average sentence occurs for a female terrorist whose primary charge is assault (at 1032 months = 86 years; the SD is NA as she was the lone female defendant with that charge).  Interestingly, the average sentence for murder or attempted murder is only 249.6 months or ~21 years, which in my opinion seems like a more serious crime than assault.

* Where we have data for female and male defendants prosecuted for the same primary crime, female defendants tend to receive shorter sentences on average, except in the cases of money laundering and assault.

```{r ddplychart}

new_df <- select(df, case_imprisonment, case_charge_1, gender) #isolates the column that I want to convert from a string to a number, along with the subgroups I need for my table

#The following code helps me remove strings like "Years" and "Months" and instead, write a formula that will calculate months
#(I wish I knew how to write this section more succinctly than multiple lines of code)
new_df2 <- mutate(new_df, new_format = str_replace(case_imprisonment, "NaN Years", "NaN"))
new_df2 <- mutate(new_df2, new_format = str_replace(new_format, "NaN Year", "NaN"))
new_df2 <- mutate(new_df2, new_format = str_replace(new_format, " Years and ","*12+"))
new_df2 <- mutate(new_df2, new_format = str_replace(new_format, " Year and ","*12+"))
new_df2 <- mutate(new_df2, new_format = str_replace(new_format, " Years","*12"))
new_df2 <- mutate(new_df2, new_format = str_replace(new_format, " Year","*12"))
new_df2 <- mutate(new_df2, new_format = str_replace(new_format, " Months",""))
new_df2 <- mutate(new_df2, new_format = str_replace(new_format, " Month",""))

#create a new column that will fill in blank entries with NAs (since we don't want blank entries to affect our mean and stdev calculations) and complete the math to arrive at months
for(i in 1:nrow(new_df2)) {
  if (new_df2$new_format[[i]] == "") {new_df2$converted_case_imprisonment[[i]] <- NA}
  else{
  new_df2$converted_case_imprisonment[[i]] <- as.numeric(eval(parse(text = new_df2$new_format[[i]])))
  }}

new_df3 <- cbind(new_df2, c(unlist(new_df2$converted_case_imprisonment))) #since the new column we created is a list, we must unlist it, vectorize it, and then column bind it
new_df3 <- new_df3[,c(-1,-4,-5)] #remove some columns
names(new_df3)[3] <- "case_imprisonment_months" #rename the column that shows the duration of case imprisonment in months

new_df4 <- filter(new_df3, !is.na(case_imprisonment_months)) #remove entries where the case imprisonment length is NA; this does not affect our stdev or mean calculation

 knitr::kable(  
ddply(new_df4, .(case_charge_1, gender), summarise, Mean = mean(case_imprisonment_months, na.rm = T), SD = sd(case_imprisonment_months, na.rm = T)))
```

This boxplot is a great graphical representation of the trends mentioned in the section above.  We can easily see that the median and standard deviation in female defendants' prison sentences is lower than males' sentences, which complements my observation that female defendants tend to receive shorter sentences compared to men prosecuted for the same crime.  Among the female defendants, there is an extreme outlier where a sole defendant received the longest (and severest) sentence among the 950 defendants prosecuted for terrorism-related crimes.

```{r boxplot_case_imprisonment}
new_df5 <- filter(new_df4, gender !="") #i want to remove data points where gender is blank in my data set so that my boxplot will have a breakout between female vs. male, rather than a third column for unknowns

boxplot(case_imprisonment_months~gender, data=new_df5, xlab = "Gender", ylab = "Prison Sentence (Months)", main = "Boxplot of Prison Sentence vs. Terrorist Defendant Gender")
```

As an alternative visualization, here we have the distribution of prison lengths (defined by the variable case_imprisonment). We can see that the majority of cases are under 200 months (~17 years), but there are some major outliers where defendants have received sentences above 700 months.
```{r}
hist(new_df4$case_imprisonment_months, xlab = "Case Imprisonment (Months)", main = "Histogram of Terrorism Defendants' Case Imprisonment Terms (in Months)")
```

### 3. Using the gmodels or another command, cross-tabulate two categorical or ordinal variables (getting proportions); and explain your results.

I have chosen to cross-tabulate gender and whether the defendant's case involved a sting operation.  I chose these variables largely because my data does not have any ordinal variables and many of my categorical variables have too many different terms, so this was a sweet spot in terms of size... and still tells a compelling story!

Before I analyze my cross-table results, I want to acknowledge that one data point will be missing from the cross-table (but present in the original data) because its "case_sting" value is NA.  I confirm this with the code below.

```{r confirm missing value}
new_df11 <- select(df, case_sting, gender)
nrow(filter(new_df11,gender == "Male" & is.na(new_df11$case_sting) == T)) #since we know there are 950 data points but only 949 show up in the cross-table, we must account for the difference. In this case, we see that one data point does not have a "case_sting" data point.
```

MY FINDINGS

* In this cross-table, we can see that the majority of cases (63.5%) did not involve sting operations (as case_sting = FALSE).  For both men and women, the majority of their arrests stemmed from non-sting methods.

* This cross-table makes it easy to see that there are few women prosecuted for terrorism-related crimes in general. After all, the total proportion of women prosecuted for terrorism is 7.6%.

* While there are missing values in our cross-table as illustrated in the blank gender column, we can also see that this only accounts for 1.3% of our data.  Since we have 937 complete data points, I feel comfortable making general observations from the data that I do have.

```{r final tabulation}
gmodels::CrossTable(new_df11$case_sting, new_df11$gender) 
```
